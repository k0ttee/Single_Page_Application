####################
# Localhost        #
# Website Server   #
# The Main Backend #
####################

#HTTP & HTTP_WWW → HTTPS
server{
        listen 80;
        server_name localhost www.localhost;
        return 301 https://localhost$request_uri;
}

#HTTPS_WWW → HTTPS
server {
        listen 443 ssl http2;
        server_name www.localhost;
        ssl_certificate     /etc/letsencrypt/live/www.localhost/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/www.localhost/privkey.pem;
        return 301 https://localhost$request_uri;
}

#HTTPS
server {
        server_name localhost;
        root /mnt/c/Users/Азъ/wsl-localhost/localhost;

        listen 443 ssl http2;
        #listen [::]:443 ssl http2 ipv6only=on;

        index index.php;

        add_header Cache-Control "private";
        expires 0;
        etag off;

        location / {
                add_header Cache-Control "private";
                expires 0;
                etag off;
                include snippets/fastcgi-php.conf;
                fastcgi_pass unix:/run/php/php7.4-fpm.sock;
        }

        ssl_certificate     /etc/letsencrypt/live/localhost/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/localhost/privkey.pem;

        add_header Strict-Transport-Security "max-age=1; includeSubDomains; preload";

        ssl_session_cache shared:SSLCACHE:64m;
        ssl_session_timeout 24h;
        keepalive_timeout 120 120;
        keepalive_requests 128;

        ssl_prefer_server_ciphers on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ALL:!aNULL:!ADH:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:+MEDIUM;
}
